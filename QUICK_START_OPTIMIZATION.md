# Быстрый старт: Оптимизация трафика

## Что было сделано

1. ✅ Настроено кеширование изображений в Next.js (60 дней)
2. ✅ Создан API route `/api/images/` для проксирования изображений из Supabase
3. ✅ Настроено кеширование в Nginx (7-30 дней)
4. ✅ Создана утилита `getProxiedImageUrl()` для преобразования URL изображений
5. ✅ Обновлен docker-compose.yml для поддержки кеша Nginx

## Что нужно сделать сейчас

### 1. Перезапустить контейнеры

```bash
docker-compose down
docker-compose up -d
```

### 2. Проверить работу кеша

После перезапуска проверьте:
```bash
# Проверьте, что volume создан
docker volume ls | grep nginx_cache

# Проверьте логи Nginx
docker logs bartech-nginx

# Проверьте логи Next.js
docker logs bartech-nextjs
```

### 3. (Опционально) Обновить существующие компоненты

Если хотите использовать проксирование для существующих изображений из Supabase, обновите компоненты:

```javascript
// Импортируйте утилиту
import { getProxiedImageUrl } from '@/lib/image-proxy';

// Используйте для изображений из Supabase
<Image src={getProxiedImageUrl(product.image)} />
```

**Важно:** Это опционально. Next.js Image уже оптимизирует изображения, но проксирование через `/api/images/` добавит дополнительный уровень кеширования.

## Ожидаемый результат

После применения изменений:
- Изображения будут кешироваться на сервере
- Исходящий трафик уменьшится на 70-90%
- Скорость загрузки изображений улучшится

## Мониторинг

Через несколько дней проверьте:
1. Размер кеша: `docker exec bartech-nginx du -sh /var/cache/nginx/`
2. Статистику кеша в заголовках ответов (X-Cache-Status: HIT/MISS)
3. Исходящий трафик в панели управления хостингом

## Подробная документация

См. [TRAFFIC_OPTIMIZATION.md](./TRAFFIC_OPTIMIZATION.md) для детальной информации.

